function D = material_elastic_matrix(E, nue, F)

D0 = E/((1+nue)*(1-2*nue))*[1-nue nue nue 0 0 0; nue 1-nue nue 0 0 0; nue nue 1-nue 0 0 0;...
    0 0 0 (1-2*nue)/2 0 0; 0 0 0 0 (1-2*nue)/2 0; 0 0 0 0 0 (1-2*nue)/2];

C0 = zeros(3,3,3,3);
% Prima riga
C0(1,1,1,1) = D0(1,1);
C0(1,1,2,2) = D0(1,2);
C0(1,1,3,3) = D0(1,3);
C0(1,1,1,2) = D0(1,4);
C0(1,1,2,3) = D0(1,5);
C0(1,1,1,3) = D0(1,6);
% Seconda riga
C0(2,2,1,1) = D0(2,1);
C0(2,2,2,2) = D0(2,2);
C0(2,2,3,3) = D0(2,3);
C0(2,2,1,2) = D0(2,4);
C0(2,2,2,3) = D0(2,5);
C0(2,2,1,3) = D0(2,6);
% Terza riga
C0(3,3,1,1) = D0(3,1);
C0(3,3,2,2) = D0(3,2);
C0(3,3,3,3) = D0(3,3);
C0(3,3,1,2) = D0(3,4);
C0(3,3,2,3) = D0(3,5);
C0(3,3,1,3) = D0(3,6);
% Quarta riga
C0(1,2,1,1) = D0(4,1);
C0(1,2,2,2) = D0(4,2);
C0(1,2,3,3) = D0(4,3);
C0(1,2,1,2) = D0(4,4);
C0(1,2,2,3) = D0(4,5);
C0(1,2,1,3) = D0(4,6);
% Quinta riga
C0(2,3,1,1) = D0(5,1);
C0(2,3,2,2) = D0(5,2);
C0(2,3,3,3) = D0(5,3);
C0(2,3,1,2) = D0(5,4);
C0(2,3,2,3) = D0(5,5);
C0(2,3,1,3) = D0(5,6);
% Sesta riga
C0(1,3,1,1) = D0(6,1);
C0(1,3,2,2) = D0(6,2);
C0(1,3,3,3) = D0(6,3);
C0(1,3,1,2) = D0(6,4);
C0(1,3,2,3) = D0(6,5);
C0(1,3,1,3) = D0(6,6);
%%
J = det(F);
C = zeros(3,3,3,3);
for i = 1:3
    for j = 1:3
        for r = 1:3
            for s = 1:3
                % Prima riga
                C(1,1,1,1) = C(1,1,1,1) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(1,1,2,2) = C(1,1,2,2) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(1,1,3,3) = C(1,1,3,3) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(1,1,1,2) = C(1,1,1,2) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(1,1,2,3) = C(1,1,2,3) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(1,1,1,3) = C(1,1,1,3) + F(1,i)*F(1,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
                % Seconda riga
                C(2,2,1,1) = C(2,2,1,1) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(2,2,2,2) = C(2,2,2,2) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(2,2,3,3) = C(2,2,3,3) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(2,2,1,2) = C(2,2,1,2) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(2,2,2,3) = C(2,2,2,3) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(2,2,1,3) = C(2,2,1,3) + F(2,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
                % Terza riga
                C(3,3,1,1) = C(3,3,1,1) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(3,3,2,2) = C(3,3,2,2) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(3,3,3,3) = C(3,3,3,3) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(3,3,1,2) = C(3,3,1,2) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(3,3,2,3) = C(3,3,2,3) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(3,3,1,3) = C(3,3,1,3) + F(3,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
                % Quarta riga
                C(1,2,1,1) = C(1,2,1,1) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(1,2,2,2) = C(1,2,2,2) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(1,2,3,3) = C(1,2,3,3) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(1,2,1,2) = C(1,2,1,2) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(1,2,2,3) = C(1,2,2,3) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(1,2,1,3) = C(1,2,1,3) + F(1,i)*F(2,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
                % Quinta riga
                C(2,3,1,1) = C(2,3,1,1) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(2,3,2,2) = C(2,3,2,2) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(2,3,3,3) = C(2,3,3,3) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(2,3,1,2) = C(2,3,1,2) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(2,3,2,3) = C(2,3,2,3) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(2,3,1,3) = C(2,3,1,3) + F(2,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
                % Sesta riga
                C(1,3,1,1) = C(1,3,1,1) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(1,s)/J;
                C(1,3,2,2) = C(1,3,2,2) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(2,s)/J;
                C(1,3,3,3) = C(1,3,3,3) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(3,r)*F(3,s)/J;
                C(1,3,1,2) = C(1,3,1,2) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(2,s)/J;
                C(1,3,2,3) = C(1,3,2,3) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(2,r)*F(3,s)/J;
                C(1,3,1,3) = C(1,3,1,3) + F(1,i)*F(3,j)*C0(i,j,r,s)*F(1,r)*F(3,s)/J;
            end
        end
    end
end
%% Riconpongo matrice di legame in Voight notations
D = zeros(6);
% Prima riga
D(1,1) = C(1,1,1,1);
D(1,2) = C(1,1,2,2);
D(1,3) = C(1,1,3,3);
D(1,4) = C(1,1,1,2);
D(1,5) = C(1,1,2,3);
D(1,6) = C(1,1,1,3);
% Seconda riga
D(2,1) = C(2,2,1,1);
D(2,2) = C(2,2,2,2);
D(2,3) = C(2,2,3,3);
D(2,4) = C(2,2,1,2);
D(2,5) = C(2,2,2,3);
D(2,6) = C(2,2,1,3);
% Terza riga
D(3,1) = C(3,3,1,1);
D(3,2) = C(3,3,2,2);
D(3,3) = C(3,3,3,3);
D(3,4) = C(3,3,1,2);
D(3,5) = C(3,3,2,3);
D(3,6) = C(3,3,1,3);
% Quarta riga
D(4,1) = C(1,2,1,1);
D(4,2) = C(1,2,2,2);
D(4,3) = C(1,2,3,3);
D(4,4) = C(1,2,1,2);
D(4,5) = C(1,2,2,3);
D(4,6) = C(1,2,1,3);
% Quinta riga
D(5,1) = C(2,3,1,1);
D(5,2) = C(2,3,2,2);
D(5,3) = C(2,3,3,3);
D(5,4) = C(2,3,1,2);
D(5,5) = C(2,3,2,3);
D(5,6) = C(2,3,1,3);
% Sesta riga
D(6,1) = C(1,3,1,1);
D(6,2) = C(1,3,2,2);
D(6,3) = C(1,3,3,3);
D(6,4) = C(1,3,1,2);
D(6,5) = C(1,3,2,3);
D(6,6) = C(1,3,1,3);

return